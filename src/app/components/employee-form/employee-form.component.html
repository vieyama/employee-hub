<app-header></app-header>

<div class="bg-gray-50">
  <div class="bg-white shadow-sm border-b border-gray-200 sticky top-[65px] z-50">
    <div class="max-w-7xl mx-auto py-3 px-4 sm:px-6 lg:px-8">
      <h1 class="text-lg font-semibold text-gray-900">{{ isEditMode ? 'Edit Employee' : 'Add New Employee' }}</h1>
    </div>
  </div>
  <div class="p-8">
    <button class="inline-flex space-x-2 items-center cursor-pointer text-gray-700" routerLink="/employees">
      <lucide-icon [img]="BackIcon" class="h-5 w-5"></lucide-icon>
      <span>Back to List</span>
    </button>

    <div class="bg-white p-3 rounded-lg shadow-sm border border-gray-100
        overflow-hidden">
      <div class="flex items-center justify-between px-6 py-4 border-b border-gray-100">
        <h2 class="text-xl font-semibold text-gray-900">
          {{ isEditMode ? 'Edit Employee Details' : 'Add New Employee Details' }}
        </h2>
      </div>
      <form [formGroup]="employeeForm" (ngSubmit)="onSubmit()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 p-4">
          <div class="">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Personal Details</h3>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="firstName">First Name</label>
              <input class="mt-0.5 w-full rounded border-gray-300 pe-10 shadow-sm sm:text-sm" type="text" id="firstName"
                formControlName="firstName">
              @if (isFieldInvalid('firstName')) {
              <div class="text-sm text-red-600 mt-1">First name is required</div>
              }
            </div>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="lastName">Last Name</label>
              <input class="mt-0.5 w-full rounded border-gray-300 pe-10 shadow-sm sm:text-sm" type="text" id="lastName"
                formControlName="lastName">
              @if (isFieldInvalid('lastName')) {
              <div class="text-sm text-red-600 mt-1">Last name is required</div>
              }
            </div>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="email">Email</label>
              <input class="mt-0.5 w-full rounded border-gray-300 pe-10 shadow-sm sm:text-sm" type="email" id="email"
                formControlName="email">
              @if (isFieldInvalid('email')) {
              <div class="text-sm text-red-600 mt-1">
                @if (employeeForm.get('email')?.hasError('required')) {
                Email is required
                } @else if (employeeForm.get('email')?.hasError('email')) {
                Please enter a valid email address
                }
              </div>
              }
            </div>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="profileImage">Profile Image URL</label>
              <input type="text" class="mt-0.5 w-full rounded border-gray-300 pe-10 shadow-sm sm:text-sm"
                id="profileImage" formControlName="profileImage" placeholder="https://example.com/image.jpg">
              @if (isFieldInvalid('profileImage')) {
              <div class="text-sm text-red-600 mt-1">Profile Image is required</div>
              }
            </div>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="description">Description</label>
              <textarea id="description" class="mt-0.5 w-full resize-none rounded border-gray-300 shadow-sm sm:text-sm"
                formControlName="description" rows="3"></textarea>
              @if (isFieldInvalid('description')) {
              <div class="text-sm text-red-600 mt-1">Description is required</div>
              }
            </div>
          </div>

          <!-- Employment Information Section -->
          <div class="">
            <h3 class="text-lg font-medium text-gray-900 mb-[18px]">Employment Information</h3>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="group">Group</label>
              <select
                class="appearance-none bg-white w-full border border-gray-300 rounded-md pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                id="group" formControlName="group" (change)="onGroupChange()">
                <option value="">Select Group</option>
                @for (dept of groups; track dept.id) {
                <option [value]="dept.name">{{ dept.name }}</option>
                }
              </select>
              @if (isFieldInvalid('group')) {
              <div class="text-sm text-red-600 mt-1">Group is required</div>
              }
            </div>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="position">Position</label>
              <select
                class="appearance-none bg-white w-full border border-gray-300 rounded-md pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                id="position" formControlName="position">
                <option value="">Select Position</option>
                @for (pos of availablePositions; track pos.id) {
                <option [value]="pos.title">{{ pos.title }}</option>
                }
              </select>
              @if (isFieldInvalid('position')) {
              <div class="text-sm text-red-600 mt-1">Position is required</div>
              }
            </div>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="birthDate">Birth Date</label>
              <input type="date" class="mt-0.5 w-full rounded border-gray-300 shadow-sm sm:text-sm" id="birthDate"
                formControlName="birthDate">
              @if (isFieldInvalid('birthDate')) {
              <div class="text-sm text-red-600 mt-1">Birth date is required</div>
              }
            </div>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="basicSalary">Salary</label>
              <input type="number" class="mt-0.5 w-full rounded border-gray-300 shadow-sm sm:text-sm" id="basicSalary"
                formControlName="basicSalary" min="0" step="1000">
              @if (isFieldInvalid('basicSalary')) {
              <div class="text-sm text-red-600 mt-1">
                @if (employeeForm.get('basicSalary')?.hasError('required')) {
                Salary is required
                } @else if (employeeForm.get('basicSalary')?.hasError('min')) {
                Salary must be greater than or equal to 0
                }
              </div>
              }
            </div>

            <div class="w-full mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1" for="status">Status</label>
              <select
                class="appearance-none bg-white w-full border border-gray-300 rounded-md pl-3 pr-8 py-2 text-sm focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                id="status" formControlName="status">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="on-leave">On Leave</option>
              </select>
              @if (isFieldInvalid('status')) {
              <div class="text-sm text-red-600 mt-1">Status is required</div>
              }
            </div>
          </div>

          <div class="flex gap-2">
            <button
              class="rounded cursor-pointer border border-gray-300 px-3 py-1.5 text-sm font-medium text-gray-900 shadow-sm transition-colors hover:bg-gray-100"
              type="button" routerLink="/employees">Cancel</button>
            <button
              class="rounded cursor-pointer border border-gray-300 px-3 py-1.5 text-sm font-medium text-gray-900 shadow-sm transition-colors hover:bg-gray-100"
              type="submit" [disabled]="employeeForm.invalid || loading">
              @if (loading) {
              <span>Saving...</span>
              } @else {
              <span>{{ isEditMode ? 'Update Employee' : 'Create Employee' }}</span>
              }
            </button>
          </div>
        </div>

      </form>
    </div>
  </div>
</div>
